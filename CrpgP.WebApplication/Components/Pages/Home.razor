@page "/"
@using CrpgP.WebApplication.Components.Layout
@using CrpgP.WebApplication.Models
@using CrpgP.WebApplication.Services
@layout HomeLayout
@inject ApiService ApiService

<PageTitle>CRPG Portraits</PageTitle>


<div class="banner">
    <img class="banner-image" src="images/tmp_banner.png" alt="Banner image">
</div>


<div class="navigation">
    <NavMenu/>
</div>


<div class="content">
    <div class="content-body">
        
        <div class="content-section welcome">
            <h2>Welcome</h2>
            <p>
                Welcome to CRPG Portraits, a site dedicated for fans of the crpg game genre. Here you can find a portrait
                that fits your character just right, for a more immersive role playing experience in your adventure.
            </p>
        </div>
        
        
        
        <div class="content-section games">
            <div class="section-title">
                <h2>Games</h2>
            </div>
            
            <div class="featured-grid container-fluid">
                @if (_games == null)
                {
                    <p>
                        <em>Loading Games...</em>
                    </p>
                }
                else
                {
                    <div class="row">
                        @foreach (var game in _games)
                        {
                            <div class="col-md-2 game-box">
                                <a href="/game/@game.Id">
                                    <ContentBoxGame
                                        DisplayName=@game.Name
                                        Slug="slug"
                                        ImagePath="path"/>
                                </a>
                            </div>
                        }
                    </div>
                }
            </div>
        </div>
        

        <div class="content-section portraits">
            <div class="section-title">
                <h2>Featured Portraits</h2>
            </div>
            <div class="featured-grid container-fluid">
                @if (_featuredPortraits == null)
                {
                    <p>
                        <em>Loading Portraits...</em>
                    </p>
                }
                else
                {
                    <div class="row">
                        @foreach (var portrait in _featuredPortraits)
                        {
                            <div class="col-md-3 portrait-box">
                                <a href="/portrait/@portrait.Id">
                                    <ContentBoxPortrait
                                        DisplayName=@portrait.DisplayName
                                        Slug="slug"
                                        ImagePath="path"/>
                                </a>
                            </div>
                        }
                    </div>
                }
            </div>
        </div>
        
        
    </div>
</div>


@code
{
    private IEnumerable<GameModel>? _games;
    private IEnumerable<PortraitModel>? _featuredPortraits;

    private int[] _portraitIds = [12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12];
    
    
    protected override async Task OnInitializedAsync()
    {
        await LoadGames();
        await LoadPortraits(_portraitIds);
    }
    
    private async Task LoadGames()
    {
        _games = await ApiService.GetAllGames();
    }
    
    private async Task LoadPortraits(int[] ids)
    {
        var result = new List<PortraitModel>();

        foreach (var id in ids)
        {
            var p = await ApiService.GetByIdAsync<PortraitModel>(id);
            if (p != null)
            {
                result.Add(p);
            }
        }
        
        _featuredPortraits = result;
    }
}
